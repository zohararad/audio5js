/*!
 * Audio5js: HTML5 Audio Compatibility Layer
 * https://github.com/zohararad/audio5js
 * License MIT (c) Zohar Arad 2013
 */
(function(e,t,n){"use strict";typeof module!="undefined"&&module.exports?module.exports=n(t,e):typeof define=="function"&&define.amd?define(function(){return n(t,e)}):e[t]=n(t,e)})(window,"Audio5js",function(e,t){"use strict";function r(e){this.message=e}function i(e){var t={},n;for(n in e)typeof e[n]=="object"?t[n]=i(e[n]):t[n]=e[n];return t}var n=t.ActiveXObject;r.prototype=new Error;var s=function(e,t){var n,r=i(t);for(n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},o=function(e,t){return s(e.prototype,t)},u={channels:{},on:function(e,t,n){this.channels[e]=this.channels[e]||[],this.channels[e].push({fn:t,ctx:n})},off:function(e,t){if(this.channels[e]===undefined)return;var n,r;for(n=0,r=this.channels[e].length;n<r;n++){var i=this.channels[e][n].fn;if(i===t){this.channels[e].splice(n,1);break}}},trigger:function(e){if(this.channels.hasOwnProperty(e)){var t=Array.prototype.slice.call(arguments,1),n,r;for(n=0,r=this.channels[e].length;n<r;n++){var i=this.channels[e][n];typeof i.fn=="function"&&i.fn.apply(i.ctx,t)}}}},a={flash_embed_code:function(){var t,r='<param name="movie" value="$2?playerInstance='+e+".flash.instances['$1']&datetime=$3\"/>"+'<param name="wmode" value="transparent"/>'+'<param name="allowscriptaccess" value="always" />'+"</object>";return n?t='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="$1">':t='<object type="application/x-shockwave-flash" data="$2?playerInstance='+e+'.flash.instances[\'$1\']&datetime=$3" width="1" height="1" id="$1" >',t+r}(),can_play:function(e){var t=document.createElement("audio"),n;switch(e){case"mp3":n='audio/mpeg; codecs="mp3"';break;case"vorbis":n='audio/ogg; codecs="vorbis"';break;case"opus":n='audio/ogg; codecs="opus"';break;case"webm":n='audio/webm; codecs="vorbis"';break;case"mp4":n='audio/mp4; codecs="mp4a.40.5"';break;case"wav":n='audio/wav; codecs="1"'}if(n===undefined)throw new Error("Unspecified Audio Mime Type");return!!t.canPlayType&&t.canPlayType(n)!==""},has_flash:function(){var e=!1;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])e=!0;else if(navigator.mimeTypes&&navigator.mimeTypes.length){var t=navigator.mimeTypes["application/x-shockwave-flash"];e=t&&t.enabledPlugin}else try{var r=new n("ShockwaveFlash.ShockwaveFlash");e=typeof r=="object"}catch(i){}return e}(),embedFlash:function(e,t){var n=document.createElement("div");n.style.position="absolute",n.style.width="1px",n.style.height="1px",n.style.top="-2px";var r=this.flash_embed_code.replace(/\$1/g,t);return r=r.replace(/\$2/g,e),r=r.replace(/\$3/g,(new Date).getTime()+Math.random()),n.innerHTML=r,document.body.appendChild(n),document.getElementById(t)},formatTime:function(e){var t=parseInt(e/3600,10)%24,n=parseInt(e/60,10)%60,r=parseInt(e%60,10),i,s=(n<10?"0"+n:n)+":"+(r<10?"0"+r:r);return t>0?i=(t<10?"0"+t:t)+":"+s:i=s,i}};a.use_flash=a.can_play("mp3");var f,l,c,h={playing:!1,vol:1,duration:0,position:0,load_percent:0,seekable:!1};l=function(){if(a.use_flash&&!a.has_flash)throw new Error("Flash Plugin Missing")},l.prototype={init:function(t){f.flash.count+=1,this.id=e+f.flash.count,f.flash.instances[this.id]=this,this.embed(t)},embed:function(e){this.audio=a.embedFlash(e,this.id)},eiReady:function(){this.trigger("ready")},eiTimeUpdate:function(e,t,n){this.position=e,this.duration=t,this.seekable=n,this.playing&&this.trigger("timeupdate",e,this.seekable?t:null)},eiProgress:function(e){this.load_percent=e,this.trigger("progress",e)},eiLoadError:function(e){this.trigger("error",e)},eiPlay:function(){this.playing=!0,this.trigger("play")},eiPause:function(){this.playing=!1,this.trigger("pause")},eiEnded:function(){this.playing=!1,this.trigger("ended")},eiCanPlay:function(){this.trigger("canplay")},reset:function(){this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(e){this.reset(),this.audio.load(e)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(e){if(e===undefined||!!isNaN(parseInt(e,10)))return this.vol;this.audio.setVolume(e),this.vol=e},seek:function(e){try{this.audio.seekTo(e),this.position=e}catch(t){}}},o(l,u),o(l,h),c=function(){},c.prototype={init:function(){this.audio=new Audio,this.audio.autoplay=!1,this.audio.preload="auto",this.audio.autobuffer=!0,this.bindEvents(),this.trigger("ready")},bindEvents:function(){this.audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.addEventListener("play",this.onPlay.bind(this)),this.audio.addEventListener("pause",this.onPause.bind(this)),this.audio.addEventListener("ended",this.onEnded.bind(this)),this.audio.addEventListener("canplay",this.onLoad.bind(this)),this.audio.addEventListener("error",this.onError.bind(this))},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onTimeUpdate:function(){this.audio.buffered!==null&&this.audio.buffered.length&&this.playing&&(this.position=this.audio.currentTime,this.duration=this.audio.duration===Infinity?null:this.audio.duration,this.trigger("timeupdate",this.position,this.duration))},onLoad:function(){this.seekable=this.audio.seekable&&this.audio.seekable.length>0,this.seekable&&(this.timer=setInterval(this.onProgress.bind(this),250)),this.trigger("canplay")},onProgress:function(){this.audio.buffered!==null&&this.audio.buffered.length&&(this.load_percent=parseInt(this.audio.buffered.end(this.audio.buffered.length-1)/this.audio.duration*100,10),this.trigger("progress",this.load_percent),this.load_percent>=100&&this.clearLoadProgress())},onError:function(e){this.trigger("error",e)},clearLoadProgress:function(){this.timer!==undefined&&(clearInterval(this.timer),delete this.timer)},reset:function(){this.clearLoadProgress(),this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(e){this.reset(),this.audio.setAttribute("src",e),this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(e){if(e===undefined||!!isNaN(parseInt(e,10)))return this.vol;var t=e<0?0:Math.min(1,e);this.audio.volume=t,this.vol=t},seek:function(e){this.position=e,this.audio.currentTime=e,this.play()}},o(c,u),o(c,h);var p={swf_path:"/swf/audiojs.swf",throw_errors:!0,format_time:!0,codecs:["mp3"]};return f=function(e){e=e||{};var t;for(t in p)p.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=p[t]);this.init(e)},f.flash={instances:{},count:0},f.can_play=function(e){return a.can_play(e)},f.prototype={init:function(e){this.settings=e,this.audio=this.getPlayer(),this.bindAudioEvents(),this.settings.use_flash?this.audio.init(e.swf_path):this.audio.init()},getPlayer:function(){var e,t,n;for(e=0,t=this.settings.codecs.length;e<t;e++){var r=this.settings.codecs[e];if(f.can_play(r)){n=new c,this.settings.use_flash=!1,this.settings.player={engine:"html",codec:r};break}}return n===undefined&&(this.settings.use_flash=!f.can_play("mp3"),n=this.settings.use_flash?new l:new c,this.settings.player={engine:this.settings.use_flash?"flash":"html",codec:"mp3"}),n},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this),this.audio.on("play",this.onPlay,this),this.audio.on("pause",this.onPause,this),this.audio.on("ended",this.onEnded,this),this.audio.on("canplay",this.onCanPlay,this),this.audio.on("timeupdate",this.onTimeUpdate,this),this.audio.on("progress",this.onProgress,this),this.audio.on("error",this.onError,this)},load:function(e){this.audio.load(e),this.trigger("load")},play:function(){this.audio.play()},pause:function(){this.audio.pause()},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(e){if(e===undefined||!!isNaN(parseInt(e,10)))return this.vol;this.audio.volume(e),this.vol=e},seek:function(e){this.audio.seek(e),this.position=e},onReady:function(){typeof this.settings.ready=="function"&&this.settings.ready.call(this,this.settings.player)},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onError:function(){var e=new r("Audio Error. Failed to Load Audio");if(this.settings.throw_errors)throw e;this.trigger("error",e)},onCanPlay:function(){this.trigger("canplay")},onTimeUpdate:function(e,t){this.position=this.settings.format_time?a.formatTime(e):e,this.duration!==t&&(this.duration=this.settings.format_time&&t!==null?a.formatTime(t):t),this.trigger("timeupdate",this.position,this.duration)},onProgress:function(e){this.load_percent=e,this.trigger("progress",e)}},o(f,u),o(f,h),f})