/*!
 * Audio5js: HTML5 Audio Compatibility Layer
 * https://github.com/zohararad/audio5js
 * License MIT (c) Zohar Arad 2013
 */
(function(c,b,a){if(typeof(module)!=="undefined"&&module.exports){module.exports=a(b,c)}else{if(typeof(define)==="function"&&define.amd){define(function(){return a(b,c)})}else{c[b]=a(b,c)}}}(window,"Audio5js",function(i,c){var e=c.ActiveXObject;function l(p){this.message=p}l.prototype=new Error();function o(q){var r={},p;for(p in q){if(typeof(q[p])==="object"){r[p]=o(q[p])}else{r[p]=q[p]}}return r}var g=function(s,q){var r,p=o(q);for(r in p){if(p.hasOwnProperty(r)){s[r]=p[r]}}return s};var b=function(q,p){return g(q.prototype,p)};var n={on:function(q,r,p){this.subscribe(q,r,p,false)},one:function(q,r,p){this.subscribe(q,r,p,true)},off:function(q,t){if(this.channels[q]===undefined){return}var r,p;for(r=0,p=this.channels[q].length;r<p;r++){var s=this.channels[q][r].fn;if(s===t){this.channels[q].splice(r,1);break}}},subscribe:function(q,s,p,r){if(this.channels===undefined){this.channels={}}this.channels[q]=this.channels[q]||[];this.channels[q].push({fn:s,ctx:p,once:(r||false)})},trigger:function(q){if(this.channels&&this.channels.hasOwnProperty(q)){var r=Array.prototype.slice.call(arguments,1);var p=[];while(this.channels[q].length>0){var s=this.channels[q].shift();if(typeof(s.fn)==="function"){s.fn.apply(s.ctx,r)}if(!s.once){p.push(s)}}this.channels[q]=p}}};var f={flash_embed_code:function(u,t,q){var r;var p='<param name="movie" value="'+t+"?playerInstance=window."+i+'_flash.instances["'+u+'"]&datetime='+q+'/><param name="wmode" value="transparent"/><param name="allowscriptaccess" value="always" /></object>';if(e){r='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="'+u+'">'}else{r='<object type="application/x-shockwave-flash" data="'+t+"?playerInstance=window."+i+'_flash.instances["'+u+'"]&datetime='+q+'" width="1" height="1" id="'+u+'" >'}return r+p},can_play:function(r){var p=document.createElement("audio");var q;switch(r){case"mp3":q='audio/mpeg; codecs="mp3"';break;case"vorbis":q='audio/ogg; codecs="vorbis"';break;case"opus":q='audio/ogg; codecs="opus"';break;case"webm":q='audio/webm; codecs="vorbis"';break;case"mp4":q='audio/mp4; codecs="mp4a.40.5"';break;case"wav":q='audio/wav; codecs="1"';break}if(q===undefined){throw new Error("Unspecified Audio Mime Type")}else{return !!p.canPlayType&&p.canPlayType(q)!==""}},has_flash:(function(){var p=false;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"]){p=true}else{if(navigator.mimeTypes&&navigator.mimeTypes.length){var t=navigator.mimeTypes["application/x-shockwave-flash"];p=t&&t.enabledPlugin}else{try{var q=new e("ShockwaveFlash.ShockwaveFlash");p=typeof(q)==="object"}catch(s){}}}return p}()),embedFlash:function(t,u){var s=document.createElement("div");s.style.position="absolute";s.style.width="1px";s.style.height="1px";s.style.top="1px";document.body.appendChild(s);if(typeof(c.swfobject)==="object"){var q={playerInstance:"window."+i+"_flash.instances['"+u+"']"};var r={allowscriptaccess:"always",wmode:"transparent"};s.innerHTML='<div id="'+u+'"></div>';swfobject.embedSWF(t+"?ts="+(new Date().getTime()+Math.random()),u,"1","1","9.0.0",null,q,r)}else{var p=new Date().getTime()+Math.random();s.innerHTML=this.flash_embed_code(u,t,p)}return document.getElementById(u)},formatTime:function(u){var q=parseInt(u/3600,10)%24;var t=parseInt(u/60,10)%60;var s=parseInt(u%60,10);var p,r=(t<10?"0"+t:t)+":"+(s<10?"0"+s:s);if(q>0){p=(q<10?"0"+q:q)+":"+r}else{p=r}return p}};f.use_flash=f.can_play("mp3");var a,m,h;var k={playing:false,vol:1,duration:0,position:0,load_percent:0,seekable:null,ready:null};var j=c[i+"_flash"]=c[i+"_flash"]||{instances:{},count:0};m=function(){if(f.use_flash&&!f.has_flash){throw new Error("Flash Plugin Missing")}};m.prototype={init:function(p){j.count+=1;this.id=i+j.count;j.instances[this.id]=this;this.embed(p)},embed:function(p){f.embedFlash(p,this.id)},eiReady:function(){this.audio=document.getElementById(this.id);this.trigger("ready")},eiLoadStart:function(){this.trigger("loadstart")},eiLoadedMetadata:function(){this.trigger("loadedmetadata")},eiCanPlay:function(){this.trigger("canplay")},eiTimeUpdate:function(p,r,q){this.position=p;this.duration=r;this.seekable=q;this.trigger("timeupdate",p,(this.seekable?r:null))},eiProgress:function(p){this.load_percent=p;this.trigger("progress",p)},eiLoadError:function(p){this.trigger("error",p)},eiPlay:function(){this.playing=true;this.trigger("play")},eiPause:function(){this.playing=false;this.trigger("pause")},eiEnded:function(){this.playing=false;this.trigger("ended")},eiSeeking:function(){this.trigger("seeking")},eiSeeked:function(){this.trigger("seeked")},reset:function(){this.seekable=false;this.duration=0;this.position=0;this.load_percent=0},load:function(p){this.reset();this.audio.load(p)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(p){if(p!==undefined&&!isNaN(parseInt(p,10))){this.audio.setVolume(p);this.vol=p}else{return this.vol}},seek:function(p){try{this.audio.seekTo(p);this.position=p}catch(q){}}};b(m,n);b(m,k);h=function(){};h.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio();this.audio.autoplay=false;this.audio.preload="auto";this.audio.autobuffer=true;this.bindEvents()},destroyAudio:function(){if(this.audio){this.unbindEvents();delete this.audio}},bindEvents:function(){this.audio.addEventListener("loadstart",this.onLoadStart.bind(this));this.audio.addEventListener("canplay",this.onLoad.bind(this));this.audio.addEventListener("loadedmetadata",this.onLoadedMetadata.bind(this));this.audio.addEventListener("play",this.onPlay.bind(this));this.audio.addEventListener("pause",this.onPause.bind(this));this.audio.addEventListener("ended",this.onEnded.bind(this));this.audio.addEventListener("error",this.onError.bind(this));this.audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this));this.audio.addEventListener("seeking",this.onSeeking.bind(this));this.audio.addEventListener("seeked",this.onSeeked.bind(this))},unbindEvents:function(){this.audio.removeEventListener("loadstart",this.onLoadStart.bind(this));this.audio.removeEventListener("canplay",this.onLoad.bind(this));this.audio.removeEventListener("loadedmetadata",this.onLoadedMetadata.bind(this));this.audio.removeEventListener("play",this.onPlay.bind(this));this.audio.removeEventListener("pause",this.onPause.bind(this));this.audio.removeEventListener("ended",this.onEnded.bind(this));this.audio.removeEventListener("error",this.onError.bind(this));this.audio.removeEventListener("timeupdate",this.onTimeUpdate.bind(this));this.audio.removeEventListener("seeking",this.onSeeking.bind(this));this.audio.removeEventListener("seeked",this.onSeeked.bind(this))},onLoadStart:function(){this.trigger("loadstart")},onLoad:function(){this.seekable=this.audio.seekable&&this.audio.seekable.length>0;if(this.seekable){this.timer=setInterval(this.onProgress.bind(this),250)}this.trigger("canplay")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=true;this.trigger("play")},onPause:function(){this.playing=false;this.trigger("pause")},onEnded:function(){this.playing=false;this.trigger("ended")},onTimeUpdate:function(){if(this.audio.buffered!==null&&this.audio.buffered.length&&this.playing){this.position=this.audio.currentTime;this.duration=this.audio.duration===Infinity?null:this.audio.duration;this.trigger("timeupdate",this.position,this.duration)}},onProgress:function(){if(this.audio.buffered!==null&&this.audio.buffered.length){this.load_percent=parseInt(((this.audio.buffered.end(this.audio.buffered.length-1)/this.audio.duration)*100),10);this.trigger("progress",this.load_percent);if(this.load_percent>=100){this.clearLoadProgress()}}},onError:function(p){this.trigger("error",p)},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},clearLoadProgress:function(){if(this.timer!==undefined){clearInterval(this.timer);delete this.timer}},reset:function(){this.clearLoadProgress();this.seekable=false;this.duration=0;this.position=0;this.load_percent=0},load:function(p){this.reset();this.destroyAudio();this.createAudio();this.audio.setAttribute("src",p);this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(p){if(p!==undefined&&!isNaN(parseInt(p,10))){var q=p<0?0:Math.min(1,p);this.audio.volume=q;this.vol=q}else{return this.vol}},seek:function(p){var q=this.playing;this.position=p;this.audio.currentTime=p;if(q){this.play()}else{if(this.audio.buffered!==null&&this.audio.buffered.length){this.trigger("timeupdate",this.position,this.duration)}}}};b(h,n);b(h,k);var d={swf_path:"/swf/audiojs.swf",throw_errors:true,format_time:true,codecs:["mp3"]};a=function(q){q=q||{};var p;for(p in d){if(d.hasOwnProperty(p)&&!q.hasOwnProperty(p)){q[p]=d[p]}}this.init(q)};a.can_play=function(p){return f.can_play(p)};a.prototype={init:function(p){this.ready=false;this.settings=p;this.audio=this.getPlayer();this.bindAudioEvents();if(this.settings.use_flash){this.audio.init(p.swf_path)}else{this.audio.init()}},getPlayer:function(){var r,p,q;if(!this.settings.use_flash){for(r=0,p=this.settings.codecs.length;r<p;r++){var s=this.settings.codecs[r];if(a.can_play(s)){q=new h();this.settings.use_flash=false;this.settings.player={engine:"html",codec:s};break}}this.settings.use_flash=true}if(q===undefined){if(!this.settings.codecs||this.settings.codecs.length==0){this.settings.use_flash=!a.can_play("mp3")}q=this.settings.use_flash?new m():new h();this.settings.player={engine:(this.settings.use_flash?"flash":"html"),codec:"mp3"}}return q},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this);this.audio.on("loadstart",this.onLoadStart,this);this.audio.on("loadedmetadata",this.onLoadedMetadata,this);this.audio.on("play",this.onPlay,this);this.audio.on("pause",this.onPause,this);this.audio.on("ended",this.onEnded,this);this.audio.on("canplay",this.onCanPlay,this);this.audio.on("timeupdate",this.onTimeUpdate,this);this.audio.on("progress",this.onProgress,this);this.audio.on("error",this.onError,this);this.audio.on("seeking",this.onSeeking,this);this.audio.on("seeked",this.onSeeked,this)},load:function(p){var q=function(r){this.audio.load(r);this.trigger("load")}.bind(this,p);if(this.ready){q()}else{this.on("ready",q)}},play:function(){if(!this.playing){this.audio.play()}},pause:function(){if(this.playing){this.audio.pause()}},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(p){if(p!==undefined&&!isNaN(parseInt(p,10))){this.audio.volume(p);this.vol=p}else{return this.vol}},seek:function(p){this.audio.seek(p);this.position=p},onReady:function(){this.ready=true;if(typeof(this.settings.ready)==="function"){this.settings.ready.call(this,this.settings.player)}this.trigger("ready")},onLoadStart:function(){this.trigger("loadstart")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=true;this.trigger("play")},onPause:function(){this.playing=false;this.trigger("pause")},onEnded:function(){this.playing=false;this.trigger("ended")},onError:function(){var p=new l("Audio Error. Failed to Load Audio");if(this.settings.throw_errors){throw p}else{this.trigger("error",p)}},onCanPlay:function(){this.trigger("canplay")},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},onTimeUpdate:function(p,q){this.position=this.settings.format_time?f.formatTime(p):p;if(this.duration!==q){this.duration=this.settings.format_time&&q!==null?f.formatTime(q):q}this.trigger("timeupdate",this.position,this.duration)},onProgress:function(p){this.load_percent=p;this.trigger("progress",p)}};b(a,n);b(a,k);return a}));